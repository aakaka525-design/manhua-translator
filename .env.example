# Manhua Translator - Environment Variables Template
# Copy this file to .env and fill in your values

# ===== API Keys (DO NOT commit real keys) =====

# PPIO GLM API (主要翻译引擎)
PPIO_API_KEY=your_ppio_api_key_here
PPIO_BASE_URL=https://api.ppio.com/openai
PPIO_MODEL=zai-org/glm-4.7-flash

# Google Gemini API (备选翻译引擎)
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-3-flash-preview

# 翻译引擎选择: ppio / gemini
AI_PROVIDER=ppio

# 其他 API (可选)
OPENAI_API_KEY=your_openai_api_key_here
DEEPL_API_KEY=your_deepl_api_key_here

# ===== Translation Settings =====
SOURCE_LANGUAGE=korean
TARGET_LANGUAGE=zh

# ===== Server Settings =====
HOST=0.0.0.0
PORT=8000
DEBUG=true

# ===== Storage Paths =====
OUTPUT_DIR=./output
TEMP_DIR=./temp

# ===== Output Format =====
OUTPUT_FORMAT=webp
WEBP_QUALITY_FINAL=90
WEBP_LOSSLESS_INTERMEDIATE=1
# WebP 切片重叠像素（高度 > 16383 时生效）
WEBP_SLICE_OVERLAP=10
# WebP 切片是否使用无损保存（仅影响 *_slices/）
WEBP_SLICES_LOSSLESS=0
# 当 OUTPUT_FORMAT=webp 且高度 > 16383 时，最终输出会拆分为 *_slices/ + *_slices.json

# ===== Model Auto-Setup =====
AUTO_SETUP_MODELS=on
MODEL_WARMUP_TIMEOUT=300
OCR_WARMUP_LANGS=korean
LAMA_DEVICE=cpu

# ===== Upscale (Real-ESRGAN, optional) =====
UPSCALE_ENABLE=0
UPSCALE_BACKEND=pytorch
UPSCALE_DEVICE=auto
UPSCALE_BINARY_PATH=tools/bin/realesrgan-ncnn-vulkan
UPSCALE_NCNN_MODEL_DIR=tools/bin/models
UPSCALE_MODEL_PATH=tools/bin/RealESRGAN_x4plus.pth
UPSCALE_MODEL=realesrgan-x4plus-anime
UPSCALE_SCALE=2
UPSCALE_TIMEOUT=120
# NCNN / PyTorch 分块推理开关（0=关闭，>0=tile大小）
UPSCALE_TILE=0
UPSCALE_STRIPE_ENABLE=0
UPSCALE_STRIPE_THRESHOLD=4000
UPSCALE_STRIPE_HEIGHT=2000
UPSCALE_STRIPE_OVERLAP=64

# ===== Inpaint Mask Tuning =====
# Fill vertical gaps between nearby OCR lines (pixels). 0 disables.
INPAINT_GAP_FILL_PX=8

# ===== Bubble Grouping (Speech Bubble Detection) =====
# Enable bubble-aware grouping to avoid merging text across different bubbles.
BUBBLE_GROUPING=1
# Minimum / maximum contour area for bubble detection
BUBBLE_MIN_AREA=1000
BUBBLE_MAX_AREA=500000
# Extra padding (pixels) added to detected bubble boxes
BUBBLE_PADDING=5
# Binary threshold for bubble detection (0-255)
BUBBLE_BINARY_THRESHOLD=240
# Ignore tiny contours that look like text boxes (bubble area must be >= region area * ratio)
BUBBLE_MIN_RELATIVE_AREA=1.6
# Minimum overlap ratio between OCR box and bubble box (intersection / region area)
BUBBLE_MIN_OVERLAP=0.35
# Fallback ratio when no bubble_id assigned in first pass
BUBBLE_MIN_RELATIVE_AREA_FALLBACK=0.9
# Fallback overlap ratio when no bubble_id assigned in first pass
BUBBLE_MIN_OVERLAP_FALLBACK=0.18

# ===== OCR Cluster Grouping (Fallback) =====
# Use OCR box clustering when bubble contours fail to map
OCR_CLUSTER_GROUPING=1
# Expand OCR boxes (ratio) before clustering
OCR_CLUSTER_PAD_X_RATIO=0.15
OCR_CLUSTER_PAD_Y_RATIO=0.6
# Clamp pad size (pixels)
OCR_CLUSTER_PAD_MIN=4
OCR_CLUSTER_PAD_MAX=120
# Distance constraints (relative to avg height)
OCR_CLUSTER_MAX_DX_RATIO=2.2
OCR_CLUSTER_MAX_DY_RATIO=2.8
OCR_CLUSTER_MIN_X_OVERLAP=0.12

# ===== Docker / Paddle Runtime Flags =====
# Install LaMa in docker image: 1=install, 0=skip (default)
INSTALL_LAMA=0
# Paddle runtime stability flags (CPU)
FLAGS_use_mkldnn=0
FLAGS_use_pir_api=0
# Skip Paddle model source connectivity check
PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK=True

# ===== Debug Toggles (0=off, 1=on) =====
DEBUG_OCR=0
DEBUG_TRANSLATOR=0
DEBUG_WATERMARK=0
DEBUG_ARTIFACTS=0
# AI Translator 日志（原文/译文输出）
AI_TRANSLATOR_LOG_MODE=off
AI_TRANSLATOR_LOG_SNIPPET_CHARS=120
AI_TRANSLATOR_LOG_CTX=0
# Include extra debug fields in quality report JSON
QUALITY_REPORT_DEBUG=0
LOW_QUALITY_THRESHOLD=0.7
LOW_QUALITY_RATIO=0.3
POST_REC=0
